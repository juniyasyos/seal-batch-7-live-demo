import http from "k6/http";
import { check, sleep } from "k6";

export const options = {
  thresholds: {
    http_req_duration: ["p(99) < 3000"], // 99% requests < 3000ms
  },
  stages: [
    { duration: "30s", target: 15 },  // Ramp-up to 15 users in 30s
    { duration: "1m", target: 15 },   // Stay at 15 users for 1m
    { duration: "20s", target: 0 },   // Ramp-down to 0 users in 20s
  ],
};

export default function () {
  const res = http.get("http://{{ hostvars[inventory_hostname].ansible_default_ipv4.address }}/stub_status");
  check(res, { "status was 200": (r) => r.status == 200 });
  sleep(1);
}
